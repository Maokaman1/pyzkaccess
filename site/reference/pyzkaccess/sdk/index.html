
<!DOCTYPE html>
<html>
<head>
  
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <title>Sdk &mdash; pyzkaccess</title>

    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <link rel="stylesheet" href="../../../css/alabaster.css" type="text/css">
    <link rel="stylesheet" href="../../../css/alabaster-overrides.css" type="text/css">

    

    
      <script src="../../../search/main.js"></script>
    

    

    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

    
  
</head>
<body>

  <div class="document">
    <div class="documentwrapper">
      <div class="bodywrapper">
        <div class="body" role="main">
          
            <h1 id="module-pyzkaccesssdk">Module pyzkaccess.sdk</h1>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>

    <span class="s1">&#39;ZKSDK&#39;</span>

<span class="p">]</span>

<span class="kn">import</span> <span class="nn">pyzkaccess.ctypes</span> <span class="kn">as</span> <span class="nn">ctypes</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">ZKSDKError</span>

<span class="k">class</span> <span class="nc">ZKSDK</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;This is machinery class which directly calls SDK functions.</span>

<span class="sd">    This is a wrapper around DLL functions of SDK, it incapsulates</span>

<span class="sd">    working with ctypes, handles errors and holds connection info.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dllpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param dllpath: path to a DLL file. Typically &quot;plcommpro.dll&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dll</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">WinDLL</span><span class="p">(</span><span class="n">dllpath</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="nd">@property</span>

    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot;Return True if connection is active&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Connect to a device.</span>

<span class="sd">        SDK: Connect()</span>

<span class="sd">        :param connstr: connection string, see docs</span>

<span class="sd">        :raises ZKSDKError:</span>

<span class="sd">        :return:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">connstr</span> <span class="o">=</span> <span class="n">connstr</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">Connect</span><span class="p">(</span><span class="n">connstr</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">PullLastError</span><span class="p">()</span>

            <span class="k">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="s2">&quot;Unable to connect a device using connstr {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">connstr</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Disconnect from a device</span>

<span class="sd">        SDK: Disconnect()</span>

<span class="sd">        :return:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">:</span>

            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">Disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">control_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">options_str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Perform an action on a device such as relay switching or reboot.</span>

<span class="sd">        For parameter meaning please see SDK docs.</span>

<span class="sd">        SDK: ControlDevice()</span>

<span class="sd">        :param operation: Number, operation id</span>

<span class="sd">        :param p1: Number, depends on operation id</span>

<span class="sd">        :param p2: Number, depends on operation id</span>

<span class="sd">        :param p3: Number, depends on operation id</span>

<span class="sd">        :param p4: Number, depends on operation id</span>

<span class="sd">        :param options_str: String, depends on operation id</span>

<span class="sd">        :raises ZKSDKError:</span>

<span class="sd">        :return: DLL function result code, 0 or positive number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">ControlDevice</span><span class="p">(</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>

            <span class="n">operation</span><span class="p">,</span>

            <span class="n">p1</span><span class="p">,</span>

            <span class="n">p2</span><span class="p">,</span>

            <span class="n">p3</span><span class="p">,</span>

            <span class="n">p4</span><span class="p">,</span>

            <span class="n">options_str</span>

        <span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;ControlDevice failed for operation {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operation</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">err</span>

    <span class="k">def</span> <span class="nf">get_rt_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Retrieve unread realtime events from a device</span>

<span class="sd">        SDK: GetRTLog()</span>

<span class="sd">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="sd">         with contents</span>

<span class="sd">        :raises ZKSDKError:</span>

<span class="sd">        :return: event string lines</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span>

        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">GetRTLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;GetRTLog failed&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="n">raw</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">raw</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>

            <span class="k">return</span> <span class="p">[]</span>

        <span class="o">*</span><span class="n">lines</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">search_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">broadcast_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Perform network scan in order to collect available ZK devices</span>

<span class="sd">        SDK: SearchDevice()</span>

<span class="sd">        :param broadcast_address: network broadcast address</span>

<span class="sd">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="sd">         with contents</span>

<span class="sd">        :raises ZKSDKError:</span>

<span class="sd">        :return: device string lines</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span>

        <span class="n">broadcast_address</span> <span class="o">=</span> <span class="n">broadcast_address</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

        <span class="n">protocol</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;UDP&#39;</span>  <span class="c1"># Only UDP works, see SDK docs</span>

        <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">SearchDevice</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">broadcast_address</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;SearchDevice failed&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="n">raw</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">raw</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>

            <span class="k">return</span> <span class="p">[]</span>

        <span class="o">*</span><span class="n">lines</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">get_device_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Fetch given device parameters</span>

<span class="sd">        SDK: GetDeviceParam()</span>

<span class="sd">        :param parameters: sequence with parameter names to be requested</span>

<span class="sd">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="sd">         with contents</span>

<span class="sd">        :raises ZKSDKError:</span>

<span class="sd">        :return: dict with requested parameters value. Each value is</span>

<span class="sd">         string</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">buf</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Device can return maximum 30 parameters for one call. See SDK</span>

        <span class="c1">#  docs. So fetch them in loop by bunches of 30 items</span>

        <span class="n">parameters_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">parameters_copy</span><span class="p">:</span>

            <span class="n">query_params</span> <span class="o">=</span> <span class="n">parameters_copy</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span>

            <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">query_params</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

            <span class="k">del</span> <span class="n">parameters_copy</span><span class="p">[:</span><span class="mi">30</span><span class="p">]</span>

            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">GetDeviceParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;GetDeviceParam failed&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">buf</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>

                <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>

                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>

            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>

                <span class="s1">&#39;Parameters returned by a device are differ than parameters was requested&#39;</span>

            <span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">set_device_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Set given device parameters</span>

<span class="sd">        SDK: SetDeviceParam()</span>

<span class="sd">        :param parameters: dict with parameter names and values to be</span>

<span class="sd">         set. Every value will be casted to string</span>

<span class="sd">        :raises ZKSDKError:</span>

<span class="sd">        :return:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">parameters</span><span class="p">:</span>

            <span class="k">return</span>

        <span class="c1"># Device can accept maximum 20 parameters for one call. See SDK</span>

        <span class="c1">#  docs. So send them in loop by bunches of 20 items</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="k">while</span> <span class="n">keys</span><span class="p">:</span>

            <span class="n">query_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>

            <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;{}={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">query_keys</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

            <span class="k">del</span> <span class="n">keys</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>

            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dll</span><span class="o">.</span><span class="n">SetDeviceParam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;SetDeviceParam failed&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</code></pre></div>


</details>
<h2 id="classes">Classes</h2>
<h3 id="zksdk">ZKSDK</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ZKSDK</span><span class="p">(</span>
    <span class="n">dllpath</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span>
</code></pre></div>


<p>This is machinery class which directly calls SDK functions.
This is a wrapper around DLL functions of SDK, it incapsulates
working with ctypes, handles errors and holds connection info.</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nl">ZKSDK</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;This is machinery class which directly calls SDK functions.</span>

<span class="ss">    This is a wrapper around DLL functions of SDK, it incapsulates</span>

<span class="ss">    working with ctypes, handles errors and holds connection info.</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">dllpath</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        :param dllpath: path to a DLL file. Typically &quot;</span><span class="n">plcommpro</span><span class="p">.</span><span class="n">dll</span><span class="ss">&quot;</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctypes</span><span class="p">.</span><span class="n">WinDLL</span><span class="p">(</span><span class="n">dllpath</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">    </span><span class="nv">@property</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">is_connected</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bool</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Return True if connection is active&quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">bool</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">connect</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">connstr</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Connect to a device.</span>

<span class="ss">        SDK: Connect()</span>

<span class="ss">        :param connstr: connection string, see docs</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return:</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">connstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connstr</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="k">Connect</span><span class="p">(</span><span class="n">connstr</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">            </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">PullLastError</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="ss">&quot;Unable to connect a device using connstr {}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">connstr</span><span class="p">),</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">disconnect</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Disconnect from a device</span>

<span class="ss">        SDK: Disconnect()</span>

<span class="ss">        :return:</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">handle</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="k">Disconnect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">control_device</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">operation</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">p3</span><span class="p">,</span><span class="w"> </span><span class="n">p4</span><span class="p">,</span><span class="w"> </span><span class="n">options_str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">int</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Perform an action on a device such as relay switching or reboot.</span>

<span class="ss">        For parameter meaning please see SDK docs.</span>

<span class="ss">        SDK: ControlDevice()</span>

<span class="ss">        :param operation: Number, operation id</span>

<span class="ss">        :param p1: Number, depends on operation id</span>

<span class="ss">        :param p2: Number, depends on operation id</span>

<span class="ss">        :param p3: Number, depends on operation id</span>

<span class="ss">        :param p4: Number, depends on operation id</span>

<span class="ss">        :param options_str: String, depends on operation id</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: DLL function result code, 0 or positive number</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">ControlDevice</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="k">operation</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">p1</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">p2</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">p3</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">p4</span><span class="p">,</span><span class="w"></span>

<span class="w">            </span><span class="n">options_str</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;ControlDevice failed for operation {}&#39;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="k">operation</span><span class="p">),</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_rt_log</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">Sequence</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Retrieve unread realtime events from a device</span>

<span class="ss">        SDK: GetRTLog()</span>

<span class="ss">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="ss">         with contents</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: event string lines</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctypes</span><span class="p">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">GetRTLog</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;GetRTLog failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;\r\n&#39;</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="o">*</span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raw</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;\r\n&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">search_device</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">broadcast_address</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">Sequence</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Perform network scan in order to collect available ZK devices</span>

<span class="ss">        SDK: SearchDevice()</span>

<span class="ss">        :param broadcast_address: network broadcast address</span>

<span class="ss">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="ss">         with contents</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: device string lines</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctypes</span><span class="p">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">broadcast_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">broadcast_address</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="s1">&#39;UDP&#39;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">Only</span><span class="w"> </span><span class="n">UDP</span><span class="w"> </span><span class="n">works</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">SDK</span><span class="w"> </span><span class="n">docs</span><span class="w"></span>

<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">SearchDevice</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span><span class="w"> </span><span class="n">broadcast_address</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;SearchDevice failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;\r\n&#39;</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="o">*</span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raw</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="ss">&quot;\r\n&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_device_param</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">parameters</span><span class="err">:</span><span class="w"> </span><span class="k">Sequence</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="nl">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Mapping</span><span class="o">[</span><span class="n">str, str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Fetch given device parameters</span>

<span class="ss">        SDK: GetDeviceParam()</span>

<span class="ss">        :param parameters: sequence with parameter names to be requested</span>

<span class="ss">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="ss">         with contents</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: dict with requested parameters value. Each value is</span>

<span class="ss">         string</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctypes</span><span class="p">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">parameters</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">call</span><span class="p">.</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="n">SDK</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w">  </span><span class="n">docs</span><span class="p">.</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="k">fetch</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">bunches</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">items</span><span class="w"></span>

<span class="w">        </span><span class="n">parameters_copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="k">parameters</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nl">parameters_copy</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">query_params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameters_copy</span><span class="o">[</span><span class="n">:30</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="n">query_params</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">del</span><span class="w"> </span><span class="n">parameters_copy</span><span class="o">[</span><span class="n">:30</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">GetDeviceParam</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_size</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;GetDeviceParam failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">pair</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">decode</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">results</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">set</span><span class="p">(</span><span class="k">parameters</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="w"></span>

<span class="w">                </span><span class="s1">&#39;Parameters returned by a device are differ than parameters was requested&#39;</span><span class="w"></span>

<span class="w">            </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">results</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">set_device_param</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">parameters</span><span class="err">:</span><span class="w"> </span><span class="n">Mapping</span><span class="o">[</span><span class="n">str, Any</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Set given device parameters</span>

<span class="ss">        SDK: SetDeviceParam()</span>

<span class="ss">        :param parameters: dict with parameter names and values to be</span>

<span class="ss">         set. Every value will be casted to string</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return:</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">parameters</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">parameters</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">call</span><span class="p">.</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="n">SDK</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w">  </span><span class="n">docs</span><span class="p">.</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">bunches</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">items</span><span class="w"></span>

<span class="w">        </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="k">parameters</span><span class="p">.</span><span class="n">keys</span><span class="p">()))</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nl">keys</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">query_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keys</span><span class="o">[</span><span class="n">:20</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="s1">&#39;{}={}&#39;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="k">parameters</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">query_keys</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">del</span><span class="w"> </span><span class="n">keys</span><span class="o">[</span><span class="n">:20</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">SetDeviceParam</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;SetDeviceParam failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__del__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="k">disconnect</span><span class="p">()</span><span class="w"></span>
</code></pre></div>


</details>
<hr />
<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">is_connected</span>
</code></pre></div>


<p>Return True if connection is active</p>
<h4 id="methods">Methods</h4>
<h5 id="connect">connect</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">connstr</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>


<p>Connect to a device.</p>
<p>SDK: Connect()
:param connstr: connection string, see docs
:raises ZKSDKError:
:return:</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">connect</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">connstr</span><span class="p">:</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">None</span><span class="p">:</span>

        <span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Connect to a device.</span>

<span class="ss">        SDK: Connect()</span>

<span class="ss">        :param connstr: connection string, see docs</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return:</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="n">connstr</span> <span class="o">=</span> <span class="n">connstr</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span>

        <span class="k">self</span><span class="p">.</span><span class="n">handle</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="k">Connect</span><span class="p">(</span><span class="n">connstr</span><span class="p">)</span>

        <span class="k">if</span> <span class="k">self</span><span class="p">.</span><span class="n">handle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">self</span><span class="p">.</span><span class="n">handle</span> <span class="o">=</span> <span class="k">None</span>

            <span class="n">err</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">PullLastError</span><span class="p">()</span>

            <span class="n">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="ss">&quot;Unable to connect a device using connstr {}&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">connstr</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>
</code></pre></div>


</details>
<h5 id="control_device">control_device</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">control_device</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">operation</span><span class="p">,</span>
    <span class="n">p1</span><span class="p">,</span>
    <span class="n">p2</span><span class="p">,</span>
    <span class="n">p3</span><span class="p">,</span>
    <span class="n">p4</span><span class="p">,</span>
    <span class="n">options_str</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>


<p>Perform an action on a device such as relay switching or reboot.
For parameter meaning please see SDK docs.</p>
<p>SDK: ControlDevice()
:param operation: Number, operation id
:param p1: Number, depends on operation id
:param p2: Number, depends on operation id
:param p3: Number, depends on operation id
:param p4: Number, depends on operation id
:param options_str: String, depends on operation id
:raises ZKSDKError:
:return: DLL function result code, 0 or positive number</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="n">control_device</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="k">operation</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">,</span> <span class="n">options_str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>

        <span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Perform an action on a device such as relay switching or reboot.</span>

<span class="ss">        For parameter meaning please see SDK docs.</span>

<span class="ss">        SDK: ControlDevice()</span>

<span class="ss">        :param operation: Number, operation id</span>

<span class="ss">        :param p1: Number, depends on operation id</span>

<span class="ss">        :param p2: Number, depends on operation id</span>

<span class="ss">        :param p3: Number, depends on operation id</span>

<span class="ss">        :param p4: Number, depends on operation id</span>

<span class="ss">        :param options_str: String, depends on operation id</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: DLL function result code, 0 or positive number</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="n">err</span> <span class="o">=</span> <span class="k">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">ControlDevice</span><span class="p">(</span>

            <span class="k">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span>

            <span class="k">operation</span><span class="p">,</span>

            <span class="n">p1</span><span class="p">,</span>

            <span class="n">p2</span><span class="p">,</span>

            <span class="n">p3</span><span class="p">,</span>

            <span class="n">p4</span><span class="p">,</span>

            <span class="n">options_str</span>

        <span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="n">raise</span> <span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;ControlDevice failed for operation {}&#39;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="k">operation</span><span class="p">),</span> <span class="n">err</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">err</span>
</code></pre></div>


</details>
<h5 id="disconnect">disconnect</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>


<p>Disconnect from a device</p>
<p>SDK: Disconnect()
:return:</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code>    <span class="n">def</span> <span class="k">disconnect</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">None</span><span class="p">:</span>

        <span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Disconnect from a device</span>

<span class="ss">        SDK: Disconnect()</span>

<span class="ss">        :return:</span>

<span class="ss">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="k">not</span> <span class="k">self</span><span class="p">.</span><span class="n">handle</span><span class="p">:</span>

            <span class="k">return</span>

        <span class="k">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="k">Disconnect</span><span class="p">(</span><span class="k">self</span><span class="p">.</span><span class="n">handle</span><span class="p">)</span>

        <span class="k">self</span><span class="p">.</span><span class="n">handle</span> <span class="o">=</span> <span class="k">None</span>
</code></pre></div>


</details>
<h5 id="get_device_param">get_device_param</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_device_param</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>


<p>Fetch given device parameters</p>
<p>SDK: GetDeviceParam()
:param parameters: sequence with parameter names to be requested
:param buffer_size: size in bytes of buffer which is filled
 with contents
:raises ZKSDKError:
:return: dict with requested parameters value. Each value is
 string</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_device_param</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">parameters</span><span class="err">:</span><span class="w"> </span><span class="k">Sequence</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="nl">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Mapping</span><span class="o">[</span><span class="n">str, str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Fetch given device parameters</span>

<span class="ss">        SDK: GetDeviceParam()</span>

<span class="ss">        :param parameters: sequence with parameter names to be requested</span>

<span class="ss">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="ss">         with contents</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: dict with requested parameters value. Each value is</span>

<span class="ss">         string</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctypes</span><span class="p">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k">parameters</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">call</span><span class="p">.</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="n">SDK</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w">  </span><span class="n">docs</span><span class="p">.</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="k">fetch</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">bunches</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">items</span><span class="w"></span>

<span class="w">        </span><span class="n">parameters_copy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="k">parameters</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nl">parameters_copy</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">query_params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameters_copy</span><span class="o">[</span><span class="n">:30</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="n">query_params</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">del</span><span class="w"> </span><span class="n">parameters_copy</span><span class="o">[</span><span class="n">:30</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">GetDeviceParam</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_size</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;GetDeviceParam failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">pair</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">decode</span><span class="p">().</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">results</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">results</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">set</span><span class="p">(</span><span class="k">parameters</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ValueError</span><span class="p">(</span><span class="w"></span>

<span class="w">                </span><span class="s1">&#39;Parameters returned by a device are differ than parameters was requested&#39;</span><span class="w"></span>

<span class="w">            </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">results</span><span class="w"></span>
</code></pre></div>


</details>
<h5 id="get_rt_log">get_rt_log</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_rt_log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>


<p>Retrieve unread realtime events from a device</p>
<p>SDK: GetRTLog()
:param buffer_size: size in bytes of buffer which is filled
 with contents
:raises ZKSDKError:
:return: event string lines</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_rt_log</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">Sequence</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Retrieve unread realtime events from a device</span>

<span class="ss">        SDK: GetRTLog()</span>

<span class="ss">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="ss">         with contents</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: event string lines</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctypes</span><span class="p">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">GetRTLog</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;GetRTLog failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;\r\n&#39;</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="o">*</span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raw</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;\r\n&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="w"></span>
</code></pre></div>


</details>
<h5 id="search_device">search_device</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">search_device</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">broadcast_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">buffer_size</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>


<p>Perform network scan in order to collect available ZK devices</p>
<p>SDK: SearchDevice()
:param broadcast_address: network broadcast address
:param buffer_size: size in bytes of buffer which is filled
 with contents
:raises ZKSDKError:
:return: device string lines</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">search_device</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">broadcast_address</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">buffer_size</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">Sequence</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Perform network scan in order to collect available ZK devices</span>

<span class="ss">        SDK: SearchDevice()</span>

<span class="ss">        :param broadcast_address: network broadcast address</span>

<span class="ss">        :param buffer_size: size in bytes of buffer which is filled</span>

<span class="ss">         with contents</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return: device string lines</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctypes</span><span class="p">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">broadcast_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">broadcast_address</span><span class="p">.</span><span class="n">encode</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="s1">&#39;UDP&#39;</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="k">Only</span><span class="w"> </span><span class="n">UDP</span><span class="w"> </span><span class="n">works</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">SDK</span><span class="w"> </span><span class="n">docs</span><span class="w"></span>

<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">SearchDevice</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span><span class="w"> </span><span class="n">broadcast_address</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;SearchDevice failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buf</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;\r\n&#39;</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="err">[]</span><span class="w"></span>

<span class="w">        </span><span class="o">*</span><span class="n">lines</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">raw</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="ss">&quot;\r\n&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lines</span><span class="w"></span>
</code></pre></div>


</details>
<h5 id="set_device_param">set_device_param</h5>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">set_device_param</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>


<p>Set given device parameters</p>
<p>SDK: SetDeviceParam()
:param parameters: dict with parameter names and values to be
 set. Every value will be casted to string
:raises ZKSDKError:
:return:</p>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">set_device_param</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">parameters</span><span class="err">:</span><span class="w"> </span><span class="n">Mapping</span><span class="o">[</span><span class="n">str, Any</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;</span>

<span class="ss">        Set given device parameters</span>

<span class="ss">        SDK: SetDeviceParam()</span>

<span class="ss">        :param parameters: dict with parameter names and values to be</span>

<span class="ss">         set. Every value will be casted to string</span>

<span class="ss">        :raises ZKSDKError:</span>

<span class="ss">        :return:</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">parameters</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">accept</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="k">parameters</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">call</span><span class="p">.</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="n">SDK</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w">  </span><span class="n">docs</span><span class="p">.</span><span class="w"> </span><span class="n">So</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">bunches</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="n">items</span><span class="w"></span>

<span class="w">        </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">sorted</span><span class="p">(</span><span class="k">parameters</span><span class="p">.</span><span class="n">keys</span><span class="p">()))</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="nl">keys</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">query_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keys</span><span class="o">[</span><span class="n">:20</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="s1">&#39;{}={}&#39;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="k">parameters</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">query_keys</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">del</span><span class="w"> </span><span class="n">keys</span><span class="o">[</span><span class="n">:20</span><span class="o">]</span><span class="w"></span>

<span class="w">            </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="n">SetDeviceParam</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">ZKSDKError</span><span class="p">(</span><span class="s1">&#39;SetDeviceParam failed&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


</details>
            
          
        </div>
      </div>
    </div>
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
      <div class="sphinxsidebarwrapper">
        
          
            
  <h1 class="logo"><a href="../../..">pyzkaccess</a></h1>



          
            



<h3>Table Of Contents</h3>

<nav>
  
  
    <ul>
    
      <li><a href="#classes">Classes</a></li>
      <ul>
    
      <li><a href="#zksdk">ZKSDK</a></li>
      <ul>
    
      <li><a href="#instance-variables">Instance variables</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#methods">Methods</a></li>
      <ul>
    
      <li><a href="#connect">connect</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#control_device">control_device</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#disconnect">disconnect</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#get_device_param">get_device_param</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#get_rt_log">get_rt_log</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#search_device">search_device</a></li>
      <ul>
    
  </ul>
    
      <li><a href="#set_device_param">set_device_param</a></li>
      <ul>
    
  </ul>
    
  </ul>
    
  </ul>
    
  </ul>
    
  </ul>
  

  
</nav>
          
            
  <h3>Related Topics</h3>
  <ul>
    
      <li>Previous: <a href="../relay/" title="previous chapter">
        Relay
      </a></li>
    
    
  </ul>

          
            <div id="searchbox" style="display: none;" role="search">
  <h3>Quick search</h3>
  <form class="search" action="../../../search.html" method="get">
    <input name="q" type="text">
    <input value="Go" type="submit">
  </form>
  <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
  </p>
</div>
<script type="text/javascript">
  document.getElementById("searchbox").style.display = "block";
</script>
          
        
      </div>
    </div>
    <div class="clearer"></div>
  </div>

  
    <div class="footer">
      
      
        
        Powered by <a href="http://www.mkdocs.org">mkdocs 1.1.2</a>
        &amp; <a href="https://github.com/iamale/mkdocs-alabaster">mkdocs-alabaster</a>
      
    </div>
  

  <!--
  MkDocs version      : 1.1.2
  Docs Build Date UTC : 2020-09-07 21:14:20.353775+00:00
  -->
</body>
</html>